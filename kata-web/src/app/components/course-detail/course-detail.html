<div class="detail-container">
  <div class="detail-header">
    <button (click)="goBack()" class="btn-back">
      ‚Üê Volver al Dashboard
    </button>
  </div>

  @if (isLoading) {
    <div class="loading-state">Cargando detalle del curso...</div>
  } @else if (error) {
    <div class="error-state">
      <p>{{ error }}</p>
      <button (click)="goBack()" class="btn-primary">Volver</button>
    </div>
  } @else if (course) {
    <div class="detail-content">
      <div class="course-header-detail">
        @if (course.badgeImage) {
          <img [src]="course.badgeImage" [alt]="course.title" class="course-badge" />
        }
        <div class="course-info">
          <span class="course-module-tag">{{ course.module }}</span>
          <h1 class="course-title-detail">{{ course.title }}</h1>
          <p class="course-meta">
            <span class="meta-item">
              <strong>Duraci√≥n:</strong> {{ course.durationHours }} horas
            </span>
            <span class="meta-item">
              <strong>Creado:</strong> {{ course.createdAt | date: 'dd/MM/yyyy' }}
            </span>
            <span class="meta-item">
              <strong>Actualizado:</strong> {{ course.updatedAt | date: 'dd/MM/yyyy' }}
            </span>
          </p>
        </div>
      </div>

      <div class="course-description-section">
        <h2>Descripci√≥n</h2>
        <p class="course-description-text">{{ course.description }}</p>
      </div>

      <div class="course-actions">
        @if (isAdmin$ | async) {
          <div class="admin-actions">
            <p class="admin-note">Como administrador, puedes editar o eliminar este curso desde el dashboard.</p>
          </div>
        } @else {
          <div class="user-actions">
            @if (completionSuccess && badgeEarned) {
              <div class="badge-earned-message">
                üèÜ ¬°Felicidades! Has completado el curso y ganado {{ badgeEarned }} badge(s)
              </div>
            }
            @if (completionError) {
              <div class="error-message">
                ‚úó {{ completionError }}
              </div>
            }
            @if (userProgress) {
              <div class="enrollment-status">
                <div class="status-badge" [class]="'status-' + userProgress.status">
                  {{ userProgress.status === 'started' ? 'En Progreso' : 'Completado ‚úì' }}
                </div>
                <div class="enrollment-details">
                  <p><strong>Comenzaste:</strong> {{ userProgress.startedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
                  @if (userProgress.completedAt) {
                    <p><strong>Completado:</strong> {{ userProgress.completedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
                  }
                </div>
                @if (userProgress.status === 'started') {
                  <button
                    class="btn-complete"
                    (click)="completeCourse()"
                    [disabled]="isCompletingCourse"
                  >
                    {{ isCompletingCourse ? 'Completando...' : 'Marcar como Completado' }}
                  </button>
                }
              </div>
            } @else {
              @if (enrollmentSuccess) {
                <div class="success-message">
                  ‚úì ¬°Te has inscrito exitosamente en este curso!
                </div>
              }
              @if (enrollmentError) {
                <div class="error-message">
                  ‚úó {{ enrollmentError }}
                </div>
              }
              <button
                class="btn-enroll"
                (click)="enrollCourse()"
                [disabled]="isEnrolling"
              >
                {{ isEnrolling ? 'Inscribiendo...' : 'Inscribirse en este curso' }}
              </button>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
